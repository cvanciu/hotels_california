---
title: "UCLA Hotels Analysis"
output:
  pdf_document: default
  html_notebook: default
---


```{r, echo=FALSE, results='hide', message=FALSE, warning=FALSE}
hotels <- read.csv("finaloperatinghotels.csv")
```

```{r, echo=FALSE, results='hide', message=FALSE, warning=FALSE}

library(tidyverse)
library(ggplot2)
library(GGally)
library(gridExtra)
library(dplyr)
library(reshape2)
library(moments)
library(ggpmisc)
library(stringr)
```

```{r, echo=FALSE, results='hide', message=FALSE, warning=FALSE}
# data set dimensions
dim(hotels)
```

There are 7,308 operating hotels in California. 

```{r, echo=FALSE, results='hide', message=FALSE, warning=FALSE}
# convert character fields to factors
factors <- names(which(sapply(hotels,is.character)))

hotels <- hotels %>%
  mutate_at(factors, as.factor)

```

```{r, echo=FALSE, results='hide', message=FALSE, warning=FALSE}
# change some back to characters

hotels <- hotels %>%
  mutate_at(vars(Amenities, Zip, Property.Address, City, County.Name, Property.Name, Parent.Company, Brand, Hotel.Operator), as.character)

```

```{r, echo=FALSE, results='hide', message=FALSE, warning=FALSE}

# create # of amenities column
hotels$Number.Of.Amenities <- lengths(strsplit(hotels$Amenities,","))

```

```{r, echo=FALSE, results='hide', message=FALSE, warning=FALSE}

# create # of high gas use amenities column
highgasuse <- c("Fully-Equipped Kitchen","Outdoor Pool","Room Service","Hot Tub","Restaurant","On-Site Bar","Meeting Event Space","Wedding Venue","Pool","Spa","On-Site Casino","Waterpark")

pattern <- str_c("\\b(", str_c(highgasuse, collapse = "|"), ")\\b")

hotels <- hotels %>%
  mutate(Number.Of.HighGasUseAmenities = str_count(Amenities, pattern))

```

```{r, echo=FALSE, results='hide', message=FALSE, warning=FALSE}

# create Gas Use tier factor column

hotels <- hotels %>% 
  mutate(Gas.Use = case_when(Number.Of.Amenities == 0 ~ 'Basic',
                             Number.Of.HighGasUseAmenities == 0 & Number.Of.Amenities > 0 ~ 'Normal',
                             TRUE ~ 'High'), Gas.Use = factor(Gas.Use, levels = c('Basic','Normal','High')))

```

## Overall Hotel Characterization

```{r, echo=FALSE, results='hide', message=FALSE, warning=FALSE}
# data summary of select fields
summaryfields <- c("Rooms","Year.Built","Year.Renovated","Number.Of.Amenities","Number.Of.HighGasUseAmenities", "Hotel.Class","Scale","Operation.Type","Hotel.Location.Type","Secondary.Type","Building.Class", "Energy.Star","Hotel.Grade","LEED.Certified","Market.Segment","Restaurant","Gas.Use")
summary(hotels[summaryfields])
```

On average, hotels have 1-2 amenities that likely use space, cooking, or water heating. About 34% of them have been renovated, less than 1% are on Energy Star or LEED Certified. 

```{r, echo=FALSE, results='hide', message=FALSE, warning=FALSE}

# distribution of # of rooms
rooms <- ggplot(hotels, aes(x = Rooms)) +
  geom_histogram(aes(y = after_stat(count/sum(count))),
    binwidth = 10, fill = "blue", color = "gray") +
  scale_y_continuous(labels = scales::percent_format(accuracy=1)) +
  scale_x_continuous(limits = c(10,110), breaks=seq(10,110,by=10)) +
  labs(x = "# of Rooms") +
  theme(axis.title.y = element_blank())

# distribution of vintage
vintage <- ggplot(hotels, aes(x = Year.Built)) +
  geom_histogram(aes(y = after_stat(count/sum(count))),
    binwidth = 10, fill = "blue", color = "gray") +
  scale_y_continuous(labels = scales::percent_format(accuracy=1)) +
  scale_x_continuous(limits = c(1950,2025), breaks=seq(1950,2025,by=10)) +
  labs(x = "Year Built") +
  theme(axis.title.y = element_blank())

# Op Type and Hotel Class
OpType <- ggplot(hotels, aes(x=Operation.Type)) + 
  geom_bar(aes(y=after_stat(count)/sum(after_stat(count)))) +
  scale_y_continuous(labels=scales::percent) +
  ylab("% frequency")

BuildingClass <- ggplot(hotels, aes(x=Building.Class)) + 
  geom_bar(aes(y=after_stat(count)/sum(after_stat(count)))) +
  scale_y_continuous(labels=scales::percent) +
  ylab("% frequency")

grid.arrange(rooms, vintage, OpType, BuildingClass, ncol = 2)

```
More than half of hotels have under 50 rooms, are built before 1990, are operated independently, and have a building class of C. C Class buildings are often older, require significant renovation, and may be located in less desirable areas. 

Equipment and energy retrofits at chain management hotels (e.g., Hilton, Marriott, Hyatt) are typically systematic and strategically coordinated efforts. Most chain hotels operate under a centralized corporate strategy, especially when managed directly by the brand (not franchisees). The corporate sustainability or facilities management team sets the overarching goals and assesses its properties to identify the best candidates for retrofits.

```{r, echo=FALSE, results='hide', message=FALSE, warning=FALSE}

# set factors for Hotel Class
hotels$Hotel.Class <- factor(hotels$Hotel.Class,
                             levels = c("Economy","Midscale","Upper Midscale","Upscale","Upper Upscale","Luxury"))

HotelClass <- ggplot(hotels, aes(x=Hotel.Class)) + 
  geom_bar(aes(y=after_stat(count)/sum(after_stat(count)))) +
  scale_y_continuous(labels=scales::percent) +
  ylab("% frequency")

LocType <- ggplot(hotels, aes(x=Hotel.Location.Type)) + 
  geom_bar(aes(y=after_stat(count)/sum(after_stat(count)))) +
  scale_y_continuous(labels=scales::percent) +
  ylab("% frequency")

do.call(grid.arrange, list(HotelClass, LocType))

```

Over half of hotels are Economy - Midscale, and located in Suburban or Small Town areas.

```{r, echo=FALSE, results='hide', message=FALSE, warning=FALSE}


Restaurant <- ggplot(hotels, aes(x=Restaurant)) + 
  geom_bar(aes(y=after_stat(count)/sum(after_stat(count)))) +
  scale_y_continuous(labels=scales::percent) +
  ylab("% frequency")

GasUse <- ggplot(hotels, aes(x=Gas.Use)) + 
  geom_bar(aes(y=after_stat(count)/sum(after_stat(count)))) +
  scale_y_continuous(labels=scales::percent) +
  ylab("% frequency")

grid.arrange(Restaurant, GasUse, ncol = 2)

```

For the roughly 25% of hotels with restaurants on site, it's important to note that it's usually only Luxury and Full-Service Chain Hotels who actually own them. It's likely that economy to mid scale, independently operated hotels lease out restaurant space they may have. 65% of hotels have amenities that likely use cooking, space, and water heating. 

### Exclude Chain Management

Considering chain hotels don't often own individual energy retrofit decision-making, let's look at Franchise or Independently operated  ones more closely.

```{r, echo=FALSE, results='hide', message=FALSE, warning=FALSE}

# slice Chain Management Operation.Type from dataset
independent <- hotels[hotels$Operation.Type != 'Chain Management',]

# data summary of select fields
summaryfields <- c("Rooms","Year.Built","Year.Renovated","Number.Of.Amenities","Number.Of.HighGasUseAmenities", "Hotel.Class","Scale","Operation.Type","Hotel.Location.Type","Secondary.Type","Building.Class", "Energy.Star","Hotel.Grade","LEED.Certified","Market.Segment","Restaurant","Gas.Use")
summary(independent[summaryfields])
```

65% of these hotels also have high gas use amenities. 32% have been renovated, virtually none are on Energy Star, less than 1% are LEED Certified. 

```{r, echo=FALSE, results='hide', message=FALSE, warning=FALSE}

# Building Class
BuildingClass <- ggplot(independent, aes(x=Building.Class)) + 
  geom_bar(aes(y=after_stat(count)/sum(after_stat(count)))) +
  scale_y_continuous(labels=scales::percent) +
  ylab("% frequency")

# Building Class & Rooms
rooms <- ggplot(data = independent, mapping = aes(y = Rooms, x = Building.Class, fill=Building.Class)) +
  geom_boxplot() + 
  ylim(0,300)

# Building Class & Year.Built
yearbuilt <- ggplot(data = independent, mapping = aes(y = Year.Built, x = Building.Class, fill=Building.Class)) +
  geom_boxplot() + 
  ylim(1900,2025)

# Hotel Class & Year.Renovated
renovated <- ggplot(data = independent, mapping = aes(y = Year.Renovated, x = Building.Class, fill=Building.Class)) +
  geom_boxplot() + 
  ylim(1980,2025)

grid.arrange(BuildingClass, rooms, yearbuilt, renovated, ncol = 2)

```

The large majority of franchise or independently operated hotels are also older, requiring renovation, and located in less desirable areas. They also have fewer than 100 rooms, are built before the year 2000, and were last renovated earlier than 2015, if at all.

```{r, echo=FALSE, results='hide', message=FALSE, warning=FALSE}

# Gas Use
ggplot(independent, aes(x=Gas.Use)) + 
  geom_bar(aes(y=after_stat(count)/sum(after_stat(count)))) +
  scale_y_continuous(labels=scales::percent) +
  ylab("% frequency")

# Gas Use & Rooms
ggplot(data = independent, mapping = aes(y = Rooms, x = Gas.Use, fill=Gas.Use)) +
  geom_boxplot() + 
  ylim(0,300)

# Gas Use & Year.Built
ggplot(data = independent, mapping = aes(y = Year.Built, x = Gas.Use, fill=Gas.Use)) +
  geom_boxplot() + 
  ylim(1900,2025)

# Gas Use & Year.Renovated
ggplot(data = independent, mapping = aes(y = Year.Renovated, x = Gas.Use, fill=Gas.Use)) +
  geom_boxplot() + 
  ylim(1980,2025)

```

About 65% of hotels have high gas use amenities. Those with High Gas Use amenities typically have more rooms, ranging from 50-100, are built around 1980, and have been renovated around 2015, if at all. These hotels tend to have a more recent vintage.

#### Building Class

```{r, echo=FALSE, results='hide', message=FALSE, warning=FALSE}

# class & gas use summary
classgassummary <- independent %>%
  count(Building.Class, Gas.Use) %>%
  group_by(Building.Class) %>%
  mutate(Percent = n/sum(n))

ggplot(classgassummary, aes(x = Building.Class, y = Percent, fill = Gas.Use)) +
  geom_col(position = 'fill') + 
  scale_y_continuous(labels = scales::percent_format()) +
  theme_minimal()

# Building Class & Rooms
ggplot(data = independent, mapping = aes(y = Rooms, x = Building.Class, fill=Gas.Use)) +
  geom_boxplot() + 
  ylim(0,200)

# Building Class & Year.Built
ggplot(data = independent, mapping = aes(y = Year.Built, x = Building.Class, fill=Gas.Use)) +
  geom_boxplot() + 
  ylim(1900,2025)

# Building Class & Year.Built
ggplot(data = independent, mapping = aes(y = Year.Renovated, x = Building.Class, fill=Gas.Use)) +
  geom_boxplot() + 
  ylim(1980,2025)

```

It seems as buildings get older, more in need of renovation, and located in less desirable areas, they tend to have fewer rooms. Fewer of them have high gas use amenities as well. Let's look at how overall amenities compare to those with high gas use across hotel size, building class, hotel class, and location type. 

#### Amenities Trends

```{r, echo=FALSE, results='hide', message=FALSE, warning=FALSE}
ggplot(independent, aes(x = Number.Of.Amenities, y = Rooms, color = Gas.Use)) +
         geom_jitter(alpha=0.7) +
         scale_x_continuous(breaks=seq(0,20, by=1)) +
         scale_y_continuous(breaks = seq(0,1000,by=50)) +
         coord_cartesian(ylim=c(0,700))+
         labs(x = "# of Amenities")

ggplot(independent, aes(x = Number.Of.Amenities, y = Number.Of.HighGasUseAmenities, color = Building.Class)) +
         geom_jitter(alpha=0.7)+
         labs(x = "# of Amenities",y="# of High Gas Use Amenities")

ggplot(independent, aes(x = Number.Of.Amenities, y = Number.Of.HighGasUseAmenities, color = Hotel.Class)) +
         geom_jitter(alph=0.7) +
         labs(x = "# of Amenities",y="# of High Gas Use Amenities")

```

There are still a good amount of hotels with 50 or less rooms that have high gas use amenities. As Building Class and Hotel Class reach a higher grade, the number of amenities and high gas use amenities go up. 

#### Hotel Class

```{r, echo=FALSE, results='hide', message=FALSE, warning=FALSE}

# Hotel Class
ggplot(independent, aes(x=Hotel.Class)) + 
  geom_bar(aes(y=after_stat(count)/sum(after_stat(count)))) +
  scale_y_continuous(labels=scales::percent) +
  ylab("% frequency")

# class & gas use summary
classgassummary <- independent %>%
  count(Hotel.Class, Gas.Use) %>%
  group_by(Hotel.Class) %>%
  mutate(Percent = n/sum(n))

ggplot(classgassummary, aes(x = Hotel.Class, y = Percent, fill = Gas.Use)) +
  geom_col(position = 'fill') + 
  scale_y_continuous(labels = scales::percent_format()) +
  theme_minimal()

# Hotel Class & Rooms
ggplot(data = independent, mapping = aes(y = Rooms, x = Hotel.Class, fill=Gas.Use)) +
  geom_boxplot() + 
  ylim(0,200)

# Hotel Class & Year.Built
ggplot(data = independent, mapping = aes(y = Year.Built, x = Hotel.Class, fill=Gas.Use)) +
  geom_boxplot() + 
  ylim(1900,2025)

```

About 60% of independent hotels are Economy or Midscale, have less than 50 rooms, and were built before 1980. It seems that higher hotel classes have more hotels with high gas use amenities. These types of amenities also seem to be at hotels with more rooms, typically at or above 50. 

#### Location Type

```{r, echo=FALSE, results='hide', message=FALSE, warning=FALSE}

# Hotel Location.Type
ggplot(independent, aes(x=Hotel.Location.Type)) + 
  geom_bar(aes(y=after_stat(count)/sum(after_stat(count)))) +
  scale_y_continuous(labels=scales::percent) +
  ylab("% frequency")

# Location.Type & gas use summary
Location.Typegassummary <- independent %>%
  count(Hotel.Location.Type, Gas.Use) %>%
  group_by(Hotel.Location.Type) %>%
  mutate(Percent = n/sum(n))

ggplot(Location.Typegassummary, aes(x = Hotel.Location.Type, y = Percent, fill = Gas.Use)) +
  geom_col(position = 'fill') + 
  scale_y_continuous(labels = scales::percent_format()) +
  theme_minimal()

# Hotel Location.Type & Rooms
ggplot(data = independent, mapping = aes(y = Rooms, x = Hotel.Location.Type, fill=Gas.Use)) +
  geom_boxplot() + 
  ylim(0,200)

# Hotel Location.Type & Year.Built
ggplot(data = independent, mapping = aes(y = Year.Built, x = Hotel.Location.Type, fill=Gas.Use)) +
  geom_boxplot() + 
  ylim(1900,2025)

```

Over 60% of hotels are located in Small or Suburban towns, and about 65% of hotels in each of these location types have high gas use amenities. Hotels with high gas use have fewer rooms in Small Towns and Resorts, where they also have older vintages (before 1980). Bigger hotels in Suburban Towns and Airports have higher gas use as well, where they are built after 1980. 

### Equitability

In seeking equitable electrification opportunities, we may want to focus on those at Economy - Midscale Class hotels with a B or C Building Class. Although the number of high gas use amenities increases at bigger, higher class hotels, we still see a substantial amount of high gas usage at lower class hotels that tend to be smaller. Perhaps we can also find larger lower class hotels with a large number of high gas use amenities.

```{r, echo=FALSE, results='hide', message=FALSE, warning=FALSE}

independent <- independent %>%
  mutate(
    Hotel.Class = factor(trimws(as.character(Hotel.Class))),
    Building.Class = factor(trimws(as.character(Building.Class)))
  )

# Economy Independent hotels
equitable <- independent %>%
  filter(Hotel.Class %in% c("Economy","Midscale") & Building.Class %in% c("B","C"))

# data summary of select fields
summaryfields <- c("Rooms","Year.Built","Year.Renovated","Number.Of.Amenities","Number.Of.HighGasUseAmenities", "Hotel.Class","Scale","Operation.Type","Hotel.Location.Type","Secondary.Type","Building.Class", "Energy.Star","Hotel.Grade","LEED.Certified","Market.Segment","Restaurant","Gas.Use")
summary(equitable[summaryfields])
```
This cuts our pool of hotels down to 3,872.

```{r, echo=FALSE, results='hide', message=FALSE, warning=FALSE}

# Gas Use
ggplot(equitable, aes(x=Gas.Use)) + 
  geom_bar(aes(y=after_stat(count)/sum(after_stat(count)))) +
  scale_y_continuous(labels=scales::percent) +
  ylab("% frequency")

# Location Type
ggplot(equitable, aes(x=Hotel.Location.Type)) + 
  geom_bar(aes(y=after_stat(count)/sum(after_stat(count)))) +
  scale_y_continuous(labels=scales::percent) +
  ylab("% frequency")

```

Nearly half of these hotels have high gas use amenities, and are still concentrated in small and suburban towns. 

```{r, echo=FALSE, results='hide', message=FALSE, warning=FALSE}
ggplot(equitable, aes(x = Number.Of.Amenities, y = Rooms, color = Gas.Use)) +
         geom_jitter(alpha=0.7) +
         scale_x_continuous(breaks=seq(0,20, by=1)) +
         scale_y_continuous(breaks = seq(0,1000,by=50)) +
         coord_cartesian(ylim=c(0,400)) + 
         labs(x = "# of Amenities")

ggplot(equitable, aes(x = Number.Of.Amenities, y = Number.Of.HighGasUseAmenities, color = Hotel.Location.Type)) +
         geom_jitter(alpha=0.7) +
         labs(x = "# of Amenities",y = "# of High Gas Use Amenities")

```

```{r, echo=FALSE, results='hide', message=FALSE, warning=FALSE}
# Location.Type & gas use summary
Location.Typegassummary <- equitable %>%
  count(Hotel.Location.Type, Gas.Use) %>%
  group_by(Hotel.Location.Type) %>%
  mutate(Percent = n/sum(n))

ggplot(Location.Typegassummary, aes(x = Hotel.Location.Type, y = Percent, fill = Gas.Use)) +
  geom_col(position = 'fill') + 
  scale_y_continuous(labels = scales::percent_format()) +
  theme_minimal()
```

Interstate and Resort locations have the highest amount of hotels with high gas use amenities, albeit representing about 10% of all hotels in this "equitability" category. Lets look at hotels with high gas use.

#### High Gas Use

```{r, echo=FALSE, results='hide', message=FALSE, warning=FALSE}
highgasuse <- equitable %>%
  filter(Gas.Use == 'High')

# data summary of select fields
summaryfields <- c("Rooms","Year.Built","Year.Renovated","Number.Of.Amenities","Number.Of.HighGasUseAmenities", "Hotel.Class","Scale","Operation.Type","Hotel.Location.Type","Secondary.Type","Building.Class", "Energy.Star","Hotel.Grade","LEED.Certified","Market.Segment","Restaurant","Gas.Use")
summary(highgasuse[summaryfields])
```
```{r, echo=FALSE, results='hide', message=FALSE, warning=FALSE}

# Location Type
ggplot(highgasuse, aes(x=Hotel.Location.Type)) + 
  geom_bar(aes(y=after_stat(count)/sum(after_stat(count)))) +
  scale_y_continuous(labels=scales::percent) +
  ylab("% frequency")

```

Close to 70% of High Gas Use hotels positioned for equitability are in Small and Suburban towns. 

```{r, echo=FALSE, results='hide', message=FALSE, warning=FALSE}

#Year Built
ggplot(highgasuse, aes(x = Year.Built)) +
  geom_histogram(aes(y = after_stat(count / sum(count))), 
                 binwidth = 5, fill = "skyblue", color = "black") +
  scale_x_continuous(limits = c(1850,2025), breaks = seq(1850,2025,by=10)) +
  scale_y_continuous(labels = scales::percent_format(accuracy=1)) +
  labs(y = "Percentage") +
  theme(axis.title.y = element_blank())

ggplot(data = highgasuse, aes(x=Year.Built, y = "")) +
  geom_boxplot(fill="skyblue") + 
  scale_x_continuous( limits=c(1900,2025), breaks=seq(1900,2025,by=10)) +
  labs(y="")

```

```{r, echo=FALSE, results='hide', message=FALSE, warning=FALSE}

# Rooms
ggplot(highgasuse, aes(x = Rooms)) +
  geom_histogram(aes(y = after_stat(count / sum(count))), 
                 binwidth = 5, fill = "orange", color = "black") +
  scale_x_continuous(limits=c(0,350), breaks = seq(0,350,by=50)) +
  scale_y_continuous(labels = scales::percent_format(accuracy=1)) +
  labs(y = "Percentage") +
  theme(axis.title.y = element_blank())

ggplot(data = highgasuse, aes(x=Rooms, y = "")) +
  geom_boxplot(fill="orange") + 
  scale_x_continuous( limits=c(0,350), breaks=seq(0,350,by=25)) +
  labs(y="")

```


```{r, echo=FALSE, results='hide', message=FALSE, warning=FALSE}

# Num Gas Amenities
ggplot(highgasuse, aes(x = Number.Of.HighGasUseAmenities)) +
  geom_histogram(aes(y = after_stat(count / sum(count))), 
                 binwidth = 1, fill = "darkgreen", color = "black") +
  scale_x_continuous(limits=c(1,8), breaks = seq(1,8,by=1)) +
  scale_y_continuous(labels = scales::percent_format(accuracy = 1)) +
  labs(y = "Percentage", x = "# of High Gas Use Amenities") +
  theme(axis.title.y = element_blank())

ggplot(data = highgasuse, aes(x=Number.Of.HighGasUseAmenities, y = "")) +
  geom_boxplot(fill="darkgreen") + 
  scale_x_continuous( limits=c(1,8), breaks=seq(1,8,by=1)) +
  labs(y="", x = "# of High Gas Use Amenities")
```

They are typically built between 1960 and 1985, have 25-75 rooms, and have 1-2 high gas use amenities

